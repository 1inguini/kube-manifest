FROM registry.1inguini.com/library/builder:latest as builder

WORKDIR /home/user/workdir
# tag 4.38.3
RUN curl -LO 'https://github.com/gitbucket/gitbucket/releases/download/4.38.3/gitbucket.war'
# curl -L -o gitbucket.war.sha256 \
# 'https://github.com/gitbucket/gitbucket/releases/download/4.38.3/gitbucket.war.sha256'

RUN sha256sum gitbucket.war

FROM docker.io/bitnami/git as git

FROM gcr.io/distroless/java11-debian11:latest

COPY --from=git /opt/bitnami/git/bin/git /usr/bin/git
COPY --from=builder --chown=nonroot:nonroot /home/user/workdir /home/nonroot

ENV LANG="ja_JP.UTF-8"

ENTRYPOINT [ "/usr/bin/java", "--jar" ]
CMD [ "/home/nonroot/gitbucket.war", "--port=8080" ]

USER nonroot